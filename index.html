<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>MATRIX TERMINAL</title>
    <style>
        body { background: #000; color: #00FF00; font-family: 'Courier New', monospace; margin: 20px; }
        #screen { 
            border: 1px solid #00FF00; 
            height: 400px; 
            overflow-y: auto; 
            padding: 10px; 
            margin-bottom: 10px;
            box-shadow: inset 0 0 10px #00FF00;
        }
        input { background: #000; border: 1px solid #00FF00; color: #00FF00; padding: 10px; width: 200px; outline: none; }
        button { background: #00FF00; color: #000; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; }
        button:hover { background: #008800; }
        .major-nick { color: #00FF00; text-shadow: 0 0 15px #00FF00; font-weight: bold; text-transform: uppercase; }
        .msg-line { margin-bottom: 5px; border-bottom: 1px solid #003300; }
    </style>
</head>
<body>

    <div id="auth-zone">
        <h1>> ACCESS_GATE</h1>
        <input type="text" id="user" placeholder="USERNAME">
        <input type="password" id="pass" placeholder="PASSWORD">
        <br><br>
        <button onclick="auth('login')">LOGIN</button>
        <button onclick="auth('register')">REGISTER</button>
    </div>

    <div id="chat-zone" style="display:none;">
        <h1>> TERMINAL: <span id="my-nick"></span></h1>
        <div id="screen"></div>
        <input type="text" id="message-input" style="width: 70%;" placeholder="Type command...">
        <button onclick="sendMessage()">SEND</button>
    </div>

    <script>
        // ЗАМЕНИ НА СВОЙ URL ИЗ NGROK, когда запустишь его на ноуте
        const API_URL = "http://127.0.0.1:4040";
        let currentUser = "";

        async function auth(type) {
            const u = document.getElementById('user').value;
            const p = document.getElementById('pass').value;

            try {
                const res = await fetch(`${API_URL}/${type}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username: u, password: p})
                });
                const data = await res.json();

                if (data.status === "success") {
                    currentUser = u;
                    document.getElementById('auth-zone').style.display = 'none';
                    document.getElementById('chat-zone').style.display = 'block';
                    document.getElementById('my-nick').innerText = u;
                    if(data.owner) document.getElementById('my-nick').classList.add('major-nick');
                    
                    // Запускаем цикл обновления сообщений
                    setInterval(loadMessages, 2000);
                } else {
                    alert("System Error: " + data.message);
                }
            } catch (e) {
                alert("Server is offline. Start your Python script!");
            }
        }

        async function sendMessage() {
            const text = document.getElementById('message-input').value;
            if(!text) return;

            await fetch(`${API_URL}/send`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username: currentUser, text: text})
            });
            document.getElementById('message-input').value = "";
            loadMessages();
        }

        async function loadMessages() {
            const res = await fetch(`${API_URL}/messages`);
            const data = await res.json();
            const screen = document.getElementById('screen');
            screen.innerHTML = data.messages.map(m => `<div class="msg-line">${m}</div>`).join('');
            screen.scrollTop = screen.scrollHeight; // Авто-скролл вниз
        }
    </script>
</body>
</html>